name: ci
on: pull_request
concurrency:
  group: ci-${{ github.ref }}
  cancel-in-progress: true
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: ".nvmrc"
      - run: |
          corepack enable
          corepack prepare --activate
      - uses: actions/cache@v4
        with:
          path: |
            **/.eslintcache
          key: lint-${{ hashFiles('**/.eslintcache') }}
          restore-keys: |
            lint-
      - run: yarn install --immutable --immutable-cache
      - run: yarn lint
  typecheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: ".nvmrc"
      - run: |
          corepack enable
          corepack prepare --activate
      - uses: actions/cache@v4
        with:
          path: |
            **/*.tsbuildinfo
          key: typecheck-${{ hashFiles('**/*.tsbuildinfo') }}
          restore-keys: |
            typecheck-
      - run: yarn install --immutable --immutable-cache
      - run: yarn typecheck
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: ".nvmrc"
      - run: |
          corepack enable
          corepack prepare --activate
      - run: yarn install --immutable --immutable-cache
      - run: yarn test
  version-check:
    runs-on: ubuntu-latest
    steps:
     - uses: actions/checkout@v4
       with:
         fetch-depth: 0
     - uses: actions/setup-node@v4
       with:
         node-version-file: ".nvmrc"
     - run: |
         corepack enable
         corepack prepare --activate
     - run: yarn install --immutable --immutable-cache
     - run: yarn version check
